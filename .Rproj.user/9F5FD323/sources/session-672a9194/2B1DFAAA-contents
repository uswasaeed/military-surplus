---
title: "Cleaning"
format: html
---

## Notebook goals

- Download the data
- Import the data
- Check datatypes
- Create a total_value variable
- Create a control_type variable
- Filter the date range (since Jan. 1 2010)
- Export the cleaned data

## Setup

Setting up and adding our libraries.

```{r}
#| label: setup
#| message: false

library(tidyverse)
```

## Downloading the data

While the data we will use here if from Prof. McDonald, it is from the [Law Enforcement Support Office](https://www.dla.mil/DispositionServices/Offers/Reutilization/LawEnforcement/PublicInformation/). Find more information [about the program here](https://www.dla.mil/DispositionServices/Offers/Reutilization/LawEnforcement/ProgramFAQs/).

```{r}
download.file(
  "https://github.com/utdata/rwd-r-leso/blob/main/data-processed/leso.csv?raw=true",
  "data-original/leso.csv",
  mode = "wb"
)
```

## Import

Importing the data into our project.

```{r}
leso_raw <- read_csv("data-original/leso.csv")

leso_raw
```

```{r}
leso_raw |> glimpse()
```

## Cleaning and changing columns

Removing the sheet column and adding a total_value column. 

```{r}
leso_tight <- leso_raw |>
  select(!sheet)

leso_tight |> glimpse()
```

```{r}
leso_total <- leso_tight |>
  mutate(total_value = quantity * acquisition_value)

leso_total |> glimpse()
```

Checking if it works.

```{r}
leso_total |> 
  slice_sample(n = 10) |>
  select(agency_name, quantity, acquisition_value, total_value)
```

## Controlled data

Categorizing the controlled data. 

```{r}
leso_control <- leso_total |> 
  mutate(
    control_type = case_when(
      str_detect(item_name, "AIRPLANE") ~ TRUE,
      (demil_code == "A" | (demil_code == "Q" & demil_ic == 6)) ~ FALSE,
      .default = TRUE
    )
  )

leso_control |> glimpse()
```

## Date filter

Filtering data to show dates past 2010. 

```{r}
leso_dated <- leso_control |> 
  filter(
    ship_date >= "2010-01-01"
  )

leso_dated |> summary()
```

## Export

Exporting our cleaned and filtered data. 

```{r}
leso_dated |> write_rds("data-processed/01-leso-clean.rds")
```

